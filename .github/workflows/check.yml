name: ZwiftPower Monitor â€” Sanity Check

on:
  workflow_dispatch:

jobs:
  sanity:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Show files in repo root
        run: |
          pwd
          ls -la
          echo "---- .github/workflows ----"
          ls -la .github/workflows || true

      - name: Verify secrets exist
        run: |
          missing=0
          for v in TARGET_URL STORAGE_STATE_B64; do
            if [ -z "${{ secrets[$v] }}" ]; then
              echo "::error::Missing secret: $v"
              missing=1
            else
              echo "OK: $v is set"
            fi
          done
          if [ -n "${{ secrets.WEBHOOK_URL }}" ] || [ -n "${{ secrets.DISCORD_WEBHOOK_URL }}" ] || [ -n "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
            echo "OK: at least one webhook is set"
          else
            echo "::warning::No webhook set (WEBHOOK_URL or DISCORD_WEBHOOK_URL or SLACK_WEBHOOK_URL)."
          fi
          test "$missing" -eq 0
